<div class="grid grid-cols-1 w-full p-5 justify-center">
  <h1 class="text-2xl text-center font-semibold mb-6">
    User Management Dashboard
  </h1>
  <div class="flex flex-wrap justify-between items-center mb-4">
    <div class="flex gap-3 btn-group flex-shrink-0">
      <button
        class="btn btn-soft"
        [disabled]="selectedIds().size === 0"
        (click)="blockSelected()"
      >
        Block
      </button>
      <button
        class="btn btn-soft btn-success"
        [disabled]="selectedIds().size === 0"
        (click)="unblockSelected()"
      >
        Unblock
      </button>
      <button
        class="btn btn-soft btn-error"
        [disabled]="selectedIds().size === 0"
        (click)="deleteSelected()"
      >
        Delete
      </button>
    </div>
    <label class="input input-bordered w-full sm:w-1/3 mt-4 sm:mt-0">
      <svg
        class="h-[1em] opacity-50 mr-2"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
      >
        <g
          stroke-linejoin="round"
          stroke-linecap="round"
          stroke-width="2.5"
          fill="none"
          stroke="currentColor"
        >
          <circle cx="11" cy="11" r="8"></circle>
          <path d="m21 21-4.3-4.3"></path>
        </g>
      </svg>
      <input
        type="search"
        class="grow"
        [value]="searchTerm()"
        (input)="onSearchInput($any($event.target).value)"
        placeholder="Search by name or email"
      />
    </label>
  </div>

  <div
    class="overflow-x-auto rounded-box border border-base-content/5 bg-base-100 select-none"
  >
    <table class="table">
      <thead>
        <tr>
          <th>
            <input
              class="checkbox"
              type="checkbox"
              [checked]="allSelected()"
              (change)="toggleAll($any($event.target).checked)"
            />
          </th>
          <th>Name</th>
          <th>Email</th>
          <th>Last seen</th>
        </tr>
      </thead>
      <tbody>
        @for (user of users(); track $index) {
        <tr>
          <th>
            <input
              class="checkbox"
              type="checkbox"
              [checked]="selectedIds().has(user.id)"
              (change)="toggleOne(user.id, $any($event.target).checked)"
            />
          </th>
          <td>
            <div class="flex items-center gap-2">
              <p>{{ user.fullName }}</p>
              @if(user.isBlocked){
              <p class="badge badge-error badge-sm">Blocked</p>
              }
            </div>
          </td>
          <td>{{ user.email }}</td>
          <td>
            {{
              user.lastLoginAt ? (user.lastLoginAt | date : "fullDate") : "—"
            }}
          </td>
        </tr>
        }
      </tbody>
    </table>
  </div>
  <div class="join mt-4 justify-center">
    <button class="join-item btn" [disabled]="page() === 1" (click)="onPrev()">
      «
    </button>
    <button class="join-item btn">{{ page() }}</button>
    <button
      class="join-item btn"
      [disabled]="page() === totalPages()"
      (click)="onNext()"
    >
      »
    </button>
  </div>
</div>
